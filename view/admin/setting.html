{extend name="admin/layout" /}

{block name="content"}
<div class="row">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">系统信息</h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-sm-4">
                        <strong>PHP版本：</strong>
                    </div>
                    <div class="col-sm-8">
                        <span id="phpVersion"><?php echo PHP_VERSION; ?></span>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4">
                        <strong>ThinkPHP版本：</strong>
                    </div>
                    <div class="col-sm-8">
                        <span id="thinkphpVersion">8.0</span>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4">
                        <strong>服务器时间：</strong>
                    </div>
                    <div class="col-sm-8">
                        <span id="serverTime"><?php echo date('Y-m-d H:i:s'); ?></span>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4">
                        <strong>数据库连接：</strong>
                    </div>
                    <div class="col-sm-8">
                        <span id="dbStatus" class="badge bg-success">正常</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">缓存管理</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-outline-primary" onclick="clearCache()">
                        <i class="bi bi-trash"></i> 清除缓存
                    </button>
                    <button type="button" class="btn btn-outline-success" onclick="optimizeDatabase()">
                        <i class="bi bi-database-check"></i> 优化数据库
                    </button>
                    <button type="button" class="btn btn-outline-info" onclick="backupDatabase()">
                        <i class="bi bi-download"></i> 备份数据库
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">系统日志</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>时间</th>
                                <th>级别</th>
                                <th>消息</th>
                            </tr>
                        </thead>
                        <tbody id="logTableBody">
                            <tr>
                                <td colspan="3" class="text-center">
                                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                                        <span class="visually-hidden">加载中...</span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    updateServerTime();
    loadSystemLogs();
    
    // 每秒更新服务器时间
    setInterval(updateServerTime, 1000);
});

function updateServerTime() {
    const now = new Date();
    document.getElementById('serverTime').textContent = now.toLocaleString('zh-CN');
}

function clearCache() {
    utils.confirm('确定要清除系统缓存吗？', () => {
        // 这里可以调用后端API清除缓存
        utils.showSuccess('缓存清除成功');
    });
}

function optimizeDatabase() {
    utils.confirm('确定要优化数据库吗？', () => {
        // 这里可以调用后端API优化数据库
        utils.showSuccess('数据库优化完成');
    });
}

function backupDatabase() {
    utils.confirm('确定要备份数据库吗？', () => {
        // 这里可以调用后端API备份数据库
        utils.showSuccess('数据库备份完成');
    });
}

function loadSystemLogs() {
    // 模拟加载系统日志
    setTimeout(() => {
        const logs = [
            { time: '2024-01-15 10:30:00', level: 'INFO', message: '系统启动成功' },
            { time: '2024-01-15 10:25:00', level: 'WARNING', message: '数据库连接池使用率较高' },
            { time: '2024-01-15 10:20:00', level: 'INFO', message: '用户登录：admin' },
            { time: '2024-01-15 10:15:00', level: 'ERROR', message: '文件上传失败：权限不足' },
            { time: '2024-01-15 10:10:00', level: 'INFO', message: '缓存更新完成' }
        ];
        
        displayLogs(logs);
    }, 1000);
}

function displayLogs(logs) {
    const tbody = document.getElementById('logTableBody');
    
    if (logs.length === 0) {
        tbody.innerHTML = '<tr><td colspan="3" class="text-center">暂无日志</td></tr>';
        return;
    }
    
    let html = '';
    logs.forEach(log => {
        const levelClass = {
            'INFO': 'text-info',
            'WARNING': 'text-warning',
            'ERROR': 'text-danger',
            'DEBUG': 'text-muted'
        }[log.level] || 'text-secondary';
        
        html += `
            <tr>
                <td>${log.time}</td>
                <td><span class="${levelClass}">${log.level}</span></td>
                <td>${log.message}</td>
            </tr>
        `;
    });
    tbody.innerHTML = html;
}
</script>
{/block} 